{"version":3,"sources":["src/modules/utils/scroll-top.js"],"names":["Scroll","el","me","init","forbiddenScroll","getStyleTargetDom","$el","setMaxValue","createRequestAnimFrame","addEventListener","handleTouchStart","bind","handleTouchMove","handleTouchEnd","prototype","startTime","startY","oldY","$event","createEvent","currentY","distance","deceleration","minValue","resetY","slowMotionFlag","maxValue","currentTime","lastY","lastTime","timer","style","window","requestAnimFrame","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","callback","setTimeout","cancelAnimationFrame","webkitCancelAnimationFrame","mozCancelAnimationFrame","oCancelAnimationFrame","clearTimeout","scrollTarge","e","scrollFunc","document","documentElement","hiddenDom","hdHight","getPxValue","defaultView","getComputedStyle","clientHeight","Math","abs","element","attr","value","currentNode","tagName","nodeType","target","indexOf","parentNode","event","stopPropagation","returnvalue","getTop","dom","transformString","top","str","Number","String","match","Event","dispatchEventLoop","dispatchEvent","scrollTop","getBoundingClientRect","computeSlowMotion","temDis","duration","Date","getTime","resetDistance","speed","destination","targetTouches","screenY","preventDefault"],"mappings":"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","file":"scroll-top.js","sourceRoot":"/Users/yejiaming/Desktop/jmyour/vue-ui","sourcesContent":["/**\n * Created by yejiaming on 2017/10/14.\n * Scroll自定义滚动事件\n */\nexport function Scroll(el) {\n    var me = this;\n    me.init(el);\n    me.forbiddenScroll(me.getStyleTargetDom(me.$el, 'overflowY', ['scroll', 'auto']));\n    me.setMaxValue();\n    me.createRequestAnimFrame();\n    me.$el.addEventListener('touchstart', me.handleTouchStart.bind(me), false);\n    me.$el.addEventListener('touchmove', me.handleTouchMove.bind(me), false);\n    me.$el.addEventListener('touchend', me.handleTouchEnd.bind(me), false);\n}\n\nScroll.prototype = {\n    // 初始化参数\n    init(el){\n        this.$el = el;\n        this.startTime = 0;\n        this.startY = 0;\n        this.oldY = null;\n        this.$event = this.createEvent();\n        this.currentY = null;\n        this.distance = null;\n        this.deceleration = 0.0006;\n        this.minValue = 0;\n        this.resetY = null;\n        this.slowMotionFlag = false;\n        this.maxValue = null;\n        this.currentTime = null;\n        this.lastY = 0;\n        this.lastTime = 0;\n        this.timer = null;\n        el.style['position'] = 'absolute';\n        el.style['width'] = '100%';\n    },\n    // requestAnimFrame重绘监听初始化\n    createRequestAnimFrame(){\n        /**\n         * 监听页面重绘的监听兼容性写法，一般配合动画效果\n         */\n        window.requestAnimFrame = (function () {\n            return window.requestAnimationFrame ||\n                window.webkitRequestAnimationFrame ||\n                window.mozRequestAnimationFrame ||\n                window.oRequestAnimationFrame ||\n                window.msRequestAnimationFrame ||\n                function (callback) {\n                    window.setTimeout(callback, 1000 / 60);\n                };\n        })();\n        /**\n         * 取消页面重绘监听的兼容性写法\n         */\n        window.cancelAnimationFrame = (function () {\n            return window.cancelAnimationFrame ||\n                window.webkitCancelAnimationFrame ||\n                window.mozCancelAnimationFrame ||\n                window.oCancelAnimationFrame ||\n                function (timer) {\n                    window.clearTimeout(timer);\n                };\n        })();\n    },\n    // 禁用原生滚动\n    forbiddenScroll(scrollTarge){\n        var me = this;\n        // IE和webkit下鼠标滚动事件\n        scrollTarge.addEventListener('mousewheel', function (e) {\n            me.scrollFunc(e);\n        });\n        //火狐下的鼠标滚动事件\n        scrollTarge.addEventListener('DOMMouseScroll', function (e) {\n            me.scrollFunc(e);\n        });\n        document.documentElement.style['overflow'] = 'hidden';  // 禁用根节点（html）的滚动条\n    },\n    // 设置最大值\n    setMaxValue(){\n        var me = this;\n        var hiddenDom = me.getStyleTargetDom(me.$el, 'overflowY', 'hidden');\n        var hdHight = me.getPxValue(document.defaultView.getComputedStyle(hiddenDom)['height']);\n        var clientHeight = Math.abs(hdHight) > 0 ? Math.abs(hdHight) : document.documentElement.clientHeight;\n        me.maxValue = me.$el.clientHeight - clientHeight;\n    },\n    // 获取想要的参数的目标节点，并指定属性以及属性值\n    getStyleTargetDom: function (element, attr, value) {\n        let currentNode = element;\n        while (currentNode && currentNode.tagName !== 'HTML' &&\n        currentNode.tagName !== 'BODY' && currentNode.nodeType === 1) {\n            let target = document.defaultView.getComputedStyle(currentNode)[attr];\n            if (value && value.indexOf(target) > -1) {\n                return currentNode;\n            }\n            currentNode = currentNode.parentNode;\n        }\n        return window;\n    },\n    // 阻止事件的冒泡\n    scrollFunc: function (e) {\n        e = e || window.event;\n        if (e && e.stopPropagation) {\n            // e.preventDefault();\n            e.stopPropagation();\n        } else {\n            e.returnvalue = false;\n            return false;\n        }\n    },\n    // 获取dom节点的top的值\n    getTop(dom){\n        var transformString = dom.style.top;\n        if (transformString) {\n            return this.getPxValue(transformString);\n        } else {\n            return 0;\n        }\n    },\n    // 获取100px中100的值\n    getPxValue(str){\n        return Number(String(str).match(/\\+?\\-?\\d+/g)[0]);\n    },\n    // 创建事件\n    createEvent(){\n        return new Event('y-scroll');\n    },\n    // 分发事件循环\n    dispatchEventLoop(){\n        this.timer = window.requestAnimFrame(()=> {\n            this.dispatchEvent();\n            this.dispatchEventLoop();\n        });\n    },\n    // 分发事件\n    dispatchEvent(){\n        this.$event.scrollTop = this.$el.getBoundingClientRect().top;\n        this.$el.dispatchEvent(this.$event);\n    },\n    // 计算缓动值\n    computeSlowMotion(temDis){\n        var duration = new Date().getTime() - this.startTime;\n        // 300毫秒是判断间隔的最佳时间\n        var resetDistance = this.currentY - this.resetY;\n        if (duration < 300 && Math.abs(resetDistance) > 10) {\n            var speed = Math.abs(resetDistance) / duration,\n                destination;\n            // 初速度为0 距离等于速度的平方除以2倍加速度\n            destination = (speed * speed) / (2 * this.deceleration) * (resetDistance < 0 ? -1 : 1);\n            this.slowMotionFlag = true;\n            return temDis += destination;\n        } else {\n            this.slowMotionFlag = false;\n            return temDis;\n        }\n    },\n    handleTouchStart(event){\n        this.lastTime = this.startTime = new Date().getTime();\n        this.distance = 0;\n        this.resetY = this.startY = event.targetTouches[0].screenY;\n        /*每次移动开始时设置初始的oldY的值*/\n        this.oldY = this.getTop(this.$el);\n        this.$el.style[\"transitionDuration\"] = '0ms';\n        this.scrollFunc(event);\n    },\n    handleTouchMove(event){\n        event.preventDefault();\n        this.currentY = event.targetTouches[0].screenY;\n        this.currentTime = new Date().getTime();\n        // 二次及以上次数滚动（间歇性滚动）时间和路程重置计算，0.05是间歇性滚动的停顿位移和时间比\n        if (Math.abs(this.currentY - this.lastY) / Math.abs(this.currentTime - this.lastTime) < 0.05) {\n            this.startTime = new Date().getTime();\n            this.resetY = this.currentY;\n        }\n        this.distance = this.currentY - this.startY;\n        let temDis = this.distance + this.oldY;\n        /*设置移动最小值*/\n        temDis = temDis > this.minValue ? temDis * 1 / 3 : temDis;\n        /*设置移动最大值*/\n        temDis = temDis < -this.maxValue ? -this.maxValue + (temDis + this.maxValue) * 1 / 3 : temDis;\n        this.$el.style[\"top\"] = temDis + 'px';\n        this.lastY = this.currentY;\n        this.lastTime = this.currentTime;\n        this.dispatchEvent();\n        this.scrollFunc(event);\n    },\n    handleTouchEnd(event){\n        /*点透事件允许通过*/\n        if (!this.distance) return;\n        event.preventDefault();\n        let temDis = this.distance + this.oldY;\n        /*计算缓动值*/\n        temDis = this.computeSlowMotion(temDis);\n        /*设置最小值*/\n        temDis = temDis > this.minValue ? this.minValue : temDis;\n        /*设置最大值*/\n        temDis = temDis < -this.maxValue ? -this.maxValue : temDis;\n        this.$el.style[\"transitionDuration\"] = '500ms';\n        this.$el.style[\"transitionTimingFunction\"] = 'ease-out';\n        /*确定最终的滚动位置*/\n        setTimeout(()=> {\n            this.$el.style[\"top\"] = temDis + 'px';\n        }, 0);\n        // 判断使用哪一种监听事件\n        if (this.slowMotionFlag) {\n            this.dispatchEventLoop();\n        } else {\n            this.dispatchEvent();\n        }\n        this.$el.addEventListener('transitionend', ()=> {\n            window.cancelAnimationFrame(this.timer);\n        });\n        this.scrollFunc(event);\n    }\n};"]}